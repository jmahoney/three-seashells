<html>
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/annyang/2.0.0/annyang.min.js"></script>
  <script src='https://code.responsivevoice.org/responsivevoice.js'></script>
  <script>
  var Internet = {
    get: function(url, callback, err) {
            err = err || function(_) {}
            var request = new XMLHttpRequest();
          	request.open("GET", url, true);
          	request.onreadystatechange = function () {
	          if (4 == request.readyState) {
                    if (200 == request.status) {
    		    callback(request.responseText);
                    } else { err(request); }
    	    }
    	};
    	request.send();
        }
    };

  function getPuppy(){
    q = "puppy";

    request = new XMLHttpRequest;
    request.open('GET', 'http://api.giphy.com/v1/gifs/random?api_key=dc6zaTOxFJmzC&tag='+q, true);

    request.onload = function() {
      if (request.status >= 200 && request.status < 400){
        data = JSON.parse(request.responseText).data.image_url;
        console.log(data);
        document.getElementById("puppy").innerHTML += '<center><img src = "'+data+'"  title="GIF via Giphy"></center>';
      } else {
        console.log('reached giphy, but API returned an error');
       }
    };

    request.onerror = function() {
      console.log('connection error');
    };

    request.send();
  }

  if (annyang) {
    annyang.debug();
    annyang.addCallback('error', function () {
      console.log('error');
    });
    annyang.addCallback('errorNetwork', function () {
      console.log('errorNetwork');
    });
    annyang.addCallback('errorPermissionDenied', function () {
      console.log('errorPermissionDenied');
    });
    annyang.addCallback('errorPermissionBlocked', function () {
      console.log('errorPermissionBlocked');
    });
    var commands = {
      '*term': function(term) {
          Internet.get("/level?term=" + term, function(response){
            responsiveVoice.speak(response);
            if(response.indexOf("fine") >= 0){
              getPuppy();
            }
          });
        }
      };

    annyang.addCommands(commands);
    annyang.setLanguage("en-NZ");
    annyang.start({ autoRestart: true, continuous: false });
  }
  </script>
</head>
<body>
<div id="puppy">
</div>
</body>
</html>
